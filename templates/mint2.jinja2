#submenu "{{ title }}" {
#	iso_path="/boot/iso/{{ filename }}"
#	export iso_path
#	img_path="/dev/disk/by-label/MP-DATA"
#	search --set=root --file "$iso_path"
#	loopback loop "$iso_path"
#
#
#    menuentry "Start Linux Mint 21.3 Cinnamon 64-bit" --class linuxmint {
#            set gfxpayload=keep
#            linux   (loop)/casper/vmlinuz  boot=casper username=mint hostname=mint quiet splash live-media-path=/casper/ ignore_uuid img_dev=$img_path img_loop=$iso_path --
#            initrd  (loop)/casper/initrd.lz
#    }
#    menuentry "Start Linux Mint 21.3 Cinnamon 64-bit (compatibility mode)" {
#            linux   (loop)/casper/vmlinuz  boot=casper username=mint hostname=mint noapic noacpi nosplash irqpoll nomodeset live-media-path=/casper/ ignore_uuid --
#            initrd  (loop)/casper/initrd.lz
#    }
#    menuentry "OEM install (for manufacturers)" {
#            set gfxpayload=keep
#            linux   (loop)/casper/vmlinuz  oem-config/enable=true only-ubiquity boot=casper username=mint hostname=mint quiet splash live-media-path=/casper/ ignore_uuid --
#            initrd  (loop)/casper/initrd.lz
#    }
#}

menuentry "{{ title }}" {

        insmod probe

        probe -u $root --set=rootuuid
        set imgdevpath="/dev/disk/by-uuid/$rootuuid"
        export imgdevpath rootuuid
        set isopath="/multibootusb/iso"
        export isopath

        for isofile in $isopath/linuxmint-*.iso; do
        if [ -e "$isofile" ]; then
                regexp --set=isoname "$isopath/(.*)" "$isofile"
                submenu "$isoname (loopback.cfg) ->" "$isofile" {
                        iso_path="$2"
                        export iso_path
                        search --set=root --file "$iso_path"
                        loopback loop "$iso_path"
                        root=(loop)
                        configfile /boot/grub/loopback.cfg
                        loopback --delete loop
                }
        fi
        done
}